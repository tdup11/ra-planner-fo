"use strict";(self.webpackChunkRAPlanner=self.webpackChunkRAPlanner||[]).push([[225],{8225:(et,b,i)=>{i.r(b),i.d(b,{RaModule:()=>tt});var d=i(9808),T=i(9762),t=i(7587),m=i(2025),S=i(8759),v=i(9783),u=i(1745),p=i(1365),y=i(7277),Z=i(1087),_=i(4119);function M(n,s){1&n&&(t.TgZ(0,"tr"),t._UZ(1,"th"),t.TgZ(2,"th",3),t._uU(3,"\xc9quipe"),t.qZA(),t.TgZ(4,"th"),t._uU(5,"R\xe9sultats"),t.qZA()())}function R(n,s){1&n&&t._UZ(0,"i",10)}function O(n,s){1&n&&t._UZ(0,"i",11)}function I(n,s){1&n&&t._UZ(0,"i",12)}function B(n,s){if(1&n&&(t.ynx(0)(1,5),t.TgZ(2,"span",6),t.YNc(3,R,1,0,"i",7),t.YNc(4,O,1,0,"i",8),t.YNc(5,I,1,0,"i",9),t.qZA(),t.BQk()()),2&n){const e=s.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngSwitch",e.getOutcome()),t.xp6(1),t.Q6J("pTooltip",o.getResultString(e))("escape",!1),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.WIN),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.LOSS),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.BYE)}}function w(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",3)(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"td"),t.YNc(9,B,6,6,"ng-container",4),t.qZA()()),2&n){const e=s.$implicit,o=s.rowIndex,a=t.oxw();t.xp6(2),t.hij(" ",o+1+a.offset*a.maxTeamsPerTable," "),t.xp6(3),t.AsE("",e.playerOne.firstName," ",e.playerOne.lastName,""),t.xp6(2),t.AsE("",e.playerTwo.firstName," ",e.playerTwo.lastName,""),t.xp6(2),t.Q6J("ngForOf",e.results)}}let A=(()=>{class n{constructor(e){this.boardService=e,this.boardId="",this.maxTeamsPerTable=8,this.offset=0,this.board=p.$.empty(),this.allTeams=[],this.subscriptions=[],this.outcomeEnum=u.j}ngOnInit(){this.boardId&&this.subscriptions.push(this.boardService.getBoard(this.boardId).subscribe(e=>{const o=p.$.deepCopy(e);this.sortTeamsByRank(o),this.allTeams=o.teams.map(y.S.deepCopy),o.teams=o.teams.slice(this.maxTeamsPerTable*this.offset,this.maxTeamsPerTable*(this.offset+1)),this.board=o}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}sortTeamsByRank(e){e.teams.sort((o,a)=>{const r=o.getOutcomes(),c=a.getOutcomes();if(r.length>c.length)return-1;if(r.length<c.length)return 1;for(let l=0;l<r.length;l++){if(r[l]!==u.j.WIN&&c[l]===u.j.WIN)return 1;if(r[l]===u.j.WIN&&c[l]!==u.j.WIN)return-1}for(let l=0;l<r.length;l++){if(r[l]===u.j.BYE&&c[l]!==u.j.BYE)return-1;if(r[l]!==u.j.BYE&&c[l]===u.j.BYE)return 1}return o.id.localeCompare(a.id)})}getResultString(e){const o=(0,u.M)(e.getOutcome()),a=this.allTeams.find(r=>r.id===e.opponentId);return o+" contre <br>"+a.playerOne.getShortFullName()+" - "+a.playerTwo.getShortFullName()+"<br>"+e.sets.map(r=>r.toString()).reduce((r,c,l,ot)=>r+", "+c)+"<br>"}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-board-table"]],inputs:{boardId:"boardId",maxTeamsPerTable:"maxTeamsPerTable",offset:"offset"},decls:3,vars:1,consts:[[3,"value"],["pTemplate","header"],["pTemplate","body"],[1,"p-1"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"pTooltip","escape"],["class","fas fa-circle-check ml-1 win-color",4,"ngSwitchCase"],["class","fa-solid fa-circle-xmark ml-1 loss-color",4,"ngSwitchCase"],["class","fa-solid fa-circle-minus ml-1 bye-color",4,"ngSwitchCase"],[1,"fas","fa-circle-check","ml-1","win-color"],[1,"fa-solid","fa-circle-xmark","ml-1","loss-color"],[1,"fa-solid","fa-circle-minus","ml-1","bye-color"]],template:function(e,o){1&e&&(t.TgZ(0,"p-table",0),t.YNc(1,M,6,0,"ng-template",1),t.YNc(2,w,10,6,"ng-template",2),t.qZA()),2&e&&t.Q6J("value",o.board.teams)},directives:[Z.iA,v.jx,d.sg,d.RF,_.u,d.n9],styles:[""]}),n})();const N=["carousel"];function F(n,s){if(1&n&&(t.TgZ(0,"div",3)(1,"h2",4),t._uU(2),t.qZA(),t._UZ(3,"app-board-table",5),t.qZA()),2&n){const e=s.$implicit;t.xp6(2),t.hij("Tableau ",e.boardId,""),t.xp6(1),t.Q6J("boardId",e.boardId)("maxTeamsPerTable",e.maxTeamsPerTable)("offset",e.offset)}}let J=(()=>{class n{constructor(e,o){this.boardService=e,this.changeDetectorRef=o,this.carousel=null,this.reducedResults=[],this.maxTeamsPerTable=8,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.boardService.getAllBoardIds().subscribe(e=>{this.reducedResults=[],e.forEach(o=>{this.boardService.getBoard(o).subscribe(a=>{for(let r=0;r<Math.ceil(a.teams.length/this.maxTeamsPerTable);r++)this.reducedResults.push(new Q(o,this.maxTeamsPerTable,r))})})}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}ngAfterContentChecked(){this.changeDetectorRef.detectChanges(),this.carousel&&(this.carousel.stopAutoplay(),this.carousel.startAutoplay())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.$),t.Y36(t.sBO))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra-results"]],viewQuery:function(e,o){if(1&e&&t.Gf(N,5),2&e){let a;t.iGM(a=t.CRH())&&(o.carousel=a.first)}},decls:3,vars:3,consts:[[3,"value","autoplayInterval","circular"],["carousel",""],["pTemplate","item"],[1,"flex","flex-column"],[1,"align-self-center","mt-0"],[3,"boardId","maxTeamsPerTable","offset"]],template:function(e,o){1&e&&(t.TgZ(0,"p-carousel",0,1),t.YNc(2,F,4,4,"ng-template",2),t.qZA()),2&e&&t.Q6J("value",o.reducedResults)("autoplayInterval",1e4)("circular",!0)},directives:[S.l,v.jx,A],styles:[""]}),n})();class Q{constructor(s,e,o){this.boardId=s,this.maxTeamsPerTable=e,this.offset=o}}var h=i(845),E=i(2638),g=i(6333),f=i(996),C=i(727);let Y=(()=>{class n{constructor(e){this.boardService=e}createByeResult(){return new g.x("BYE",[],this.boardService.getWinningSets(),!0,new Date)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(m.$))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var j=i(97),U=i(2324),$=i(7010),x=i(2382);function q(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"p-inputNumber",9),t.NdJ("ngModelChange",function(a){return t.CHM(e).$implicit.selfScore=a}),t.qZA(),t.TgZ(2,"span",3),t._uU(3,"-"),t.qZA(),t.TgZ(4,"p-inputNumber",10),t.NdJ("ngModelChange",function(a){return t.CHM(e).$implicit.opponentScore=a}),t.qZA()()}if(2&n){const e=s.$implicit;t.xp6(1),t.Q6J("size",1)("ngModel",e.selfScore)("min",0),t.xp6(3),t.Q6J("size",1)("ngModel",e.opponentScore)("min",0)}}let P=(()=>{class n{constructor(e){this.boardService=e,this.onSendResult=new t.vpe}ngOnInit(){}addSet(){this.match.sets.push(new f.l(null,null))}sendResult(){this.onSendResult.emit(this.match)}canAddSet(){return this.match.sets.length<2*this.boardService.getWinningSets()-1}canSendMatch(){return(0,U.s)(this.match.sets,this.boardService.getWinningSets())!==u.j.NOT_FINISHED}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ongoing-match"]],inputs:{match:"match",teamOne:"teamOne",teamTwo:"teamTwo"},outputs:{onSendResult:"onSendResult"},decls:18,vars:7,consts:[[1,"flex","flex-column","gap-1"],[1,"grid"],[1,"col-5"],[1,"col-2","align-self-center","text-center"],[1,"col-5","text-right"],["class","grid",4,"ngFor","ngForOf"],[1,"flex","gap-1","justify-content-between"],["pButton","","icon","fas fa-plus","pTooltip","Ajouter un set",3,"disabled","click"],["pButton","","icon","fas fa-check","pTooltip","Valider le match",1,"p-button-success",3,"disabled","click"],["mode","decimal",1,"col-5","justify-content-start",3,"size","ngModel","min","ngModelChange"],["mode","decimal",1,"col-5","justify-content-end",3,"size","ngModel","min","ngModelChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p"),t._uU(4),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.TgZ(7,"span",3),t._uU(8,"-"),t.qZA(),t.TgZ(9,"div",4)(10,"p"),t._uU(11),t.qZA(),t.TgZ(12,"p"),t._uU(13),t.qZA()()(),t.YNc(14,q,5,6,"div",5),t.TgZ(15,"div",6)(16,"button",7),t.NdJ("click",function(){return o.addSet()}),t.qZA(),t.TgZ(17,"button",8),t.NdJ("click",function(){return o.sendResult()}),t.qZA()()()),2&e&&(t.xp6(4),t.Oqu(o.teamOne.playerOne.getShortFullName()),t.xp6(2),t.Oqu(o.teamOne.playerTwo.getShortFullName()),t.xp6(5),t.Oqu(o.teamTwo.playerOne.getShortFullName()),t.xp6(2),t.Oqu(o.teamTwo.playerTwo.getShortFullName()),t.xp6(1),t.Q6J("ngForOf",o.match.sets),t.xp6(2),t.Q6J("disabled",!o.canAddSet()),t.xp6(1),t.Q6J("disabled",!o.canSendMatch()))},directives:[d.sg,$.Rn,x.JJ,x.On,h.Hq,_.u],styles:[""]}),n})();function D(n,s){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-ongoing-match",5),t.NdJ("onSendResult",function(a){return t.CHM(e),t.oxw().addResultToTeams(a)}),t.qZA(),t.BQk()}if(2&n){const e=s.$implicit,o=t.oxw();t.xp6(1),t.Q6J("match",e)("teamOne",o.getTeam(e.teamOneId))("teamTwo",o.getTeam(e.teamTwoId))}}function W(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",6),t.NdJ("click",function(){return t.CHM(e),t.oxw().generateNewMatches()}),t._uU(1,"G\xe9n\xe9rer le tour suivant"),t.qZA()}}let k=(()=>{class n{constructor(e,o){this.boardService=e,this.matchService=o,this._boardId="",this.board=p.$.empty(),this.turnMessage=[],this.currentBoardSubscription=new C.w0}set boardId(e){this._boardId=e,this.currentBoardSubscription.unsubscribe(),this.currentBoardSubscription=this.getBoardSubscription(e)}get boardId(){return this._boardId}ngOnInit(){this.currentBoardSubscription=this.getBoardSubscription(this.boardId)}ngOnDestroy(){this.currentBoardSubscription.unsubscribe()}canGenerateMatches(){return 0!==this.board.teams.length&&this.board.teams.every(e=>e.results.length===this.board.turn-1)&&0===this.board.ongoingMatches.length&&!this.board.isFinished()}generateNewMatches(){const e=new Map;for(let a=0;a<2**this.board.turn-1;a++)e.set(a,[]);this.board.teams.forEach(a=>{let r=0;a.results.sort(g.x.sort).forEach((c,l)=>{c.getOutcome()===u.j.WIN&&(r+=2**l)}),e.get(r).push(a)});const o=[];for(let a of e.values()){a=a.sort((r,c)=>r.id.localeCompare(c.id));for(let r=0;r<a.length;r+=2)r===a.length-1&&a.length%2==1?a[r].results.push(this.matchService.createByeResult()):o.push(new E.q(a[r].id,a[r+1].id,[]))}this.board.ongoingMatches=o,this.boardService.setBoard(this.board)}addResultToTeams(e){const o=this.board.teams.find(r=>r.id===e.teamOneId),a=this.board.teams.find(r=>r.id===e.teamTwoId);o.results.push(new g.x(a.id,e.sets.map(f.l.deepCopy),this.boardService.getWinningSets(),!1,new Date)),a.results.push(new g.x(o.id,e.sets.map(f.l.reverseDeepCopy),this.boardService.getWinningSets(),!1,new Date)),this.board.ongoingMatches=this.board.ongoingMatches.filter(r=>r.id!==e.id),!this.board.isFinished()&&this.board.teams.every(r=>r.results.length===this.board.turn)&&this.board.turn++,this.boardService.setBoard(this.board)}getBoardSubscription(e){return e?this.boardService.getBoard(e).subscribe(o=>{this.board=p.$.deepCopy(o),this.turnMessage=this.board.isFinished()?[{severity:"error",summary:"Tour "+this.board.turn+" sur "+this.board.size,icon:"fa-solid fa-circle-stop"}]:[{severity:"success",summary:"Tour "+this.board.turn+" sur "+this.board.size,icon:"fa-solid fa-circle-play"}]}):new C.w0}getTeam(e){return this.board.teams.find(o=>o.id===e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.$),t.Y36(Y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-board-ongoing-matches"]],inputs:{boardId:"boardId"},decls:5,vars:4,consts:[[3,"value","closable"],[1,"two-items-grid"],[4,"ngFor","ngForOf"],[1,"flex","justify-content-center"],["pButton","",3,"click",4,"ngIf"],[3,"match","teamOne","teamTwo","onSendResult"],["pButton","",3,"click"]],template:function(e,o){1&e&&(t._UZ(0,"p-messages",0),t.TgZ(1,"div",1),t.YNc(2,D,2,3,"ng-container",2),t.qZA(),t.TgZ(3,"div",3),t.YNc(4,W,2,0,"button",4),t.qZA()),2&e&&(t.Q6J("value",o.turnMessage)("closable",!1),t.xp6(2),t.Q6J("ngForOf",o.board.ongoingMatches),t.xp6(2),t.Q6J("ngIf",o.canGenerateMatches()))},directives:[j.V,d.sg,P,d.O5,h.Hq],styles:[".two-items-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-auto-rows:minmax(0,auto);grid-column-gap:1rem;column-gap:1rem;grid-row-gap:2rem;row-gap:2rem}"]}),n})();const z=function(n){return{"p-button-outlined":n}};function H(n,s){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",4),t.NdJ("click",function(a){const c=t.CHM(e).$implicit;return t.oxw().onClick(a,c)}),t.qZA(),t.BQk()}if(2&n){const e=s.$implicit,o=t.oxw();t.xp6(1),t.Q6J("label",e)("ngClass",t.VKq(2,z,e!==o.selectedId))}}function G(n,s){if(1&n&&t._UZ(0,"app-board-ongoing-matches",5),2&n){const e=t.oxw();t.Q6J("boardId",e.selectedId)}}let X=(()=>{class n{constructor(e){this.boardService=e,this.boardIds=[],this.selectedId="",this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.boardService.getAllBoardIds().subscribe(e=>{this.boardIds=e.slice()}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onClick(e,o){this.selectedId=String(o)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra-matches"]],decls:4,vars:2,consts:[[1,"flex","flex-column","gap-2","align-items-center"],[1,"flex","gap-1"],[4,"ngFor","ngForOf"],["class","mx-2",3,"boardId",4,"ngIf"],["pButton","",3,"label","ngClass","click"],[1,"mx-2",3,"boardId"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,H,2,4,"ng-container",2),t.qZA(),t.YNc(3,G,1,1,"app-board-ongoing-matches",3),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngForOf",o.boardIds),t.xp6(1),t.Q6J("ngIf",o.selectedId))},directives:[d.sg,h.Hq,d.mk,d.O5,k],styles:[""]}),n})();const L=[{path:"",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra"]],decls:5,vars:0,consts:[[1,"grid","mt-3"],[1,"col-6"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"app-ra-results"),t.qZA(),t.TgZ(3,"div",1),t._UZ(4,"app-ra-matches"),t.qZA()())},directives:[J,X],styles:[""]}),n})()}];let V=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[T.Bz.forChild(L)],T.Bz]}),n})();var K=i(6997);let tt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[d.ez,V,K.m]]}),n})()}}]);